RewriteEngine On

# Forçar HTTPS em produção (descomente quando em produção)
# RewriteCond %{HTTPS} off
# RewriteCond %{HTTP:X-Forwarded-Proto} !https
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Configuração da pasta raiz do projeto
# Para XAMPP, o RewriteBase deve ser relativo ao DocumentRoot
# ATUALIZADO: Nome correto do projeto é Up.Bal-es (com hífen)
RewriteBase /Up.Bal-es/

# Se o arquivo ou pasta existir, não faz nada (carrega o arquivo real)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# Ignora pastas de sistema e arquivos estáticos
# ATUALIZADO: Usar o nome correto do projeto Up.Bal-es
RewriteCond %{REQUEST_URI} !^/Up\.Bal-es/(pages|services|css|js|Images|utils|database|uploads)/
RewriteCond %{REQUEST_URI} !^/Up\.Bal-es/.*\.(html|php|css|js|jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot)$

# Rotas amigáveis para páginas do decorador
# IMPORTANTE: Estas regras funcionam para URLs como /Up.Bal-es/slug/rota

# Rotas específicas do decorador (devem vir antes da regra geral do slug)
# /{slug}/login -> services/login_view.php?slug={slug}
RewriteRule ^([a-zA-Z0-9-]+)/login/?$ services/login_view.php?slug=$1 [L,QSA]

# /{slug}/cadastro -> services/cadastro_view.php?slug={slug}
RewriteRule ^([a-zA-Z0-9-]+)/cadastro/?$ services/cadastro_view.php?slug=$1 [L,QSA]

# /{slug}/carrinho -> services/carrinho.php?slug={slug}
RewriteRule ^([a-zA-Z0-9-]+)/carrinho/?$ services/carrinho.php?slug=$1 [L,QSA]

# /{slug}/solicitar -> services/solicitacao.php?slug={slug}
RewriteRule ^([a-zA-Z0-9-]+)/solicitar/?$ services/solicitacao.php?slug=$1 [L,QSA]

# /{slug}/minhas-compras -> services/minhas-compras.php?slug={slug}
RewriteRule ^([a-zA-Z0-9-]+)/minhas-compras/?$ services/minhas-compras.php?slug=$1 [L,QSA]

# Redireciona slugs de decoradores para 'pagina-decorador.php'
# Aceita apenas letras, números e hífens (slug válido)
# IMPORTANTE: Esta regra funciona para URLs como /Up.Bal-es/slug
RewriteRule ^([a-zA-Z0-9-]+)/?$ services/pagina-decorador.php?slug=$1 [L,QSA]

# Segurança
<Files "*.sql">
    Order Allow,Deny
    Deny from all
</Files>
<Files "*.log">
    Order Allow,Deny
    Deny from all
</Files>

Options -Indexes